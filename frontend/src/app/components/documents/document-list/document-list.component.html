<div class="container list-container">
  <div class="header">
    <h2>Documents</h2>
    <button mat-raised-button color="primary" id="btnUploadDocument" (click)="openUploadDialog()" matTooltip="Upload a new document">
      <mat-icon>add</mat-icon>
      Upload Document
    </button> 
     
  </div>
  <mat-card class="table-card">
    <mat-card-content>
      @if (isLoading) {
        <div class="loading">
          <mat-spinner></mat-spinner>
        </div>
      }
      @if (!isLoading && documents.length === 0) {
        <div class="empty-state">
          <mat-icon fontSize="48">folder_open</mat-icon>
          <p>No documents found.</p>
        </div>
      }
      @if (!isLoading && documents.length > 0) {
        <table mat-table [dataSource]="documents" class="full-width">
          <!-- Title Column -->
          <ng-container matColumnDef="title">
            <th mat-header-cell *matHeaderCellDef>Title</th>
            <td mat-cell *matCellDef="let document">{{ document.title }}</td>
          </ng-container>
          <!-- Original Name Column -->
          <ng-container matColumnDef="originalName">
            <th mat-header-cell *matHeaderCellDef>File Name</th>
            <td mat-cell *matCellDef="let document">{{ document.originalName }}</td>
          </ng-container>
          <!-- Size Column -->
          <ng-container matColumnDef="size">
            <th mat-header-cell *matHeaderCellDef>Size</th>
            <td mat-cell *matCellDef="let document">{{ document.size | fileSize }}</td>
          </ng-container>
          <!-- Upload Date Column -->
          <ng-container matColumnDef="createdAt">
            <th mat-header-cell *matHeaderCellDef>Uploaded</th>
            <td mat-cell *matCellDef="let document">{{ document.createdAt | date:'medium' }}</td>
          </ng-container>
          <!-- Ingested Status Column -->
          <ng-container matColumnDef="isIngested">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let document">
              <mat-chip [color]="document.isIngested ? 'accent' : 'warn'" >
              <!-- <mat-icon>{{ document.isIngested ? 'check_circle' : 'error' }}</mat-icon> -->
              {{ document.isIngested ? 'Ingested' : 'Not Ingested' }}
              </mat-chip>
              
            </td>
          </ng-container>
          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let document">
              <button mat-icon-button [matMenuTriggerFor]="actionMenu" [matMenuTriggerData]="{ document: document }" matTooltip="More actions">
                <mat-icon>more_vert</mat-icon>
              </button>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          @for (row of documents; track row.id) {
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          }
        </table>
      }
      <mat-menu #actionMenu="matMenu">
        <ng-template matMenuContent let-document="document">
          <button mat-menu-item (click)="downloadDocument(document)" matTooltip="Download">
            <mat-icon>download</mat-icon>
            <span>Download</span>
          </button>
          <mat-divider></mat-divider>
          <button mat-menu-item (click)="deleteDocument(document)" class="delete-action" matTooltip="Delete">
            <mat-icon>delete</mat-icon>
            <span>Delete</span>
          </button>
        </ng-template>
      </mat-menu>
    </mat-card-content>
  </mat-card>
</div>